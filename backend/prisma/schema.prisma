// backend/prisma/schema.prisma

// 1. ESTO ES LO QUE FALTABA (Configuración)
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 2. TUS MODELOS NUEVOS

// La Competencia General (El Padre)
// Ej: "100m Planos Varonil", "400m Relevos"
model Competition {
  id        Int      @id @default(autoincrement())
  nombre    String
  genero    String?  // "M" o "F"
  
  // Relación: Una competencia tiene muchos Hits/Carreras hijas
  races     Race[]   
}

// La Carrera/Hit específico (El Hijo)
// Ej: "Hit 1", "Semifinal", "Final"
model Race {
  id            Int         @id @default(autoincrement())
  nombre        String      // Ej: "Hit 1"
  estado        RaceStatus  @default(PENDING)
  fecha         DateTime    @default(now())
  
  // Relación con el Padre (Competencia)
  competencia   Competition @relation(fields: [competenciaId], references: [id])
  competenciaId Int

  // Relación con los resultados (Los 8 carriles de ESTE hit)
  resultados    Result[]
}

// Atletas
model Athlete {
  id        Int      @id @default(autoincrement())
  no_dorsal Int      @unique
  nombre    String
  equipo    String?
  creadoEn  DateTime @default(now())
  
  resultados Result[]
}

// Resultados
model Result {
  id        Int      @id @default(autoincrement())
  carril    Int
  tiempo    Float?
  posicion  Int?
  
  atleta    Athlete @relation(fields: [atletaId], references: [id])
  atletaId  Int
  
  carrera   Race    @relation(fields: [carreraId], references: [id])
  carreraId Int

  @@unique([carreraId, carril]) 
}

enum RaceStatus {
  PENDING
  LIVE
  FINISHED
}